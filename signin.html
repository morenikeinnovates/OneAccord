<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In ‚Äî OneAccord</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Onest:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="shared.css">
<style>
body { background:var(--surface); }
.auth-page { min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px; }
.auth-back { position:fixed;top:20px;left:20px; }
.auth-back a { font-size:13px;font-weight:600;color:var(--muted);text-decoration:none;display:flex;align-items:center;gap:6px;padding:8px 14px;border:1px solid var(--border);border-radius:8px;background:#fff;transition:all .2s; }
.auth-back a:hover { color:var(--ink);border-color:var(--ink); }
.auth-box { width:100%;max-width:420px;background:#fff;border:1.5px solid var(--border);border-radius:20px;padding:40px;box-shadow:var(--shadow2);animation:fadeUp .4s ease; }
.auth-logo { display:flex;align-items:center;gap:8px;font-size:18px;font-weight:700;color:var(--ink);margin-bottom:32px;text-decoration:none; }
.auth-logo-dot { width:8px;height:8px;border-radius:50%;background:var(--lime); }
.auth-h2 { font-size:24px;font-weight:800;letter-spacing:-.5px;color:var(--ink);margin-bottom:8px; }
.auth-sub { font-size:14px;color:var(--muted);line-height:1.6;margin-bottom:28px; }
.auth-label { font-size:12px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;color:var(--muted);margin-bottom:8px;display:block; }
.auth-input { width:100%;font-family:inherit;font-size:16px;color:var(--ink);background:var(--surface);border:1.5px solid var(--border);border-radius:10px;padding:13px 16px;transition:border-color .2s;outline:none;margin-bottom:16px; }
.auth-input:focus { border-color:var(--lime); }
.auth-btn { width:100%;background:var(--ink);color:#fff;border:none;font-family:inherit;font-size:15px;font-weight:600;padding:14px;border-radius:10px;cursor:pointer;transition:all .2s; }
.auth-btn:hover { background:var(--ink2); }
.auth-btn:disabled { opacity:.5;cursor:not-allowed; }
.auth-skip { text-align:center;margin-top:16px;font-size:13px;color:var(--muted); }
.auth-skip a { color:var(--muted);text-decoration:underline;cursor:pointer; }

/* OTP step */
.otp-inputs { display:flex;gap:10px;margin-bottom:20px; }
.otp-digit { width:52px;height:60px;text-align:center;font-family:inherit;font-size:24px;font-weight:700;border:1.5px solid var(--border);border-radius:10px;background:var(--surface);outline:none;color:var(--ink);transition:border-color .2s; }
.otp-digit:focus { border-color:var(--lime); }
.auth-email-shown { background:var(--lime-bg);border:1px solid #c8e87a;border-radius:8px;padding:10px 14px;font-size:14px;font-weight:600;color:#4a6b1a;margin-bottom:20px; }
.auth-demo-note { background:var(--amber-bg);border:1px solid #f0cc80;border-radius:8px;padding:10px 14px;font-size:12px;color:#8a5a00;margin-bottom:16px;line-height:1.5; }
.auth-resend { font-size:13px;color:var(--muted);text-align:center;margin-top:12px; }
.auth-resend button { color:var(--ink);cursor:pointer;text-decoration:underline;background:none;border:none;font-family:inherit;font-size:13px; }

@media(max-width:600px){
  .auth-box { padding:28px 20px;border-radius:16px; }
  .auth-h2 { font-size:20px; }
  .otp-inputs { gap:6px; }
  .otp-digit { width:42px;height:52px;font-size:20px; }
}
</style>
</head>
<body>

<div class="auth-back">
  <a href="index.html">‚Üê Back</a>
</div>

<div class="auth-page">

  <!-- Step 1: Email Entry -->
  <div class="auth-box" id="step-email">
    <a class="auth-logo" href="index.html"><div class="auth-logo-dot"></div>OneAccord</a>
    <h2 class="auth-h2" id="auth-h2">Welcome back.</h2>
    <p class="auth-sub" id="auth-sub">Enter your email to sign in ‚Äî no password needed. We'll send you a 6-digit code.</p>
    <label class="auth-label">Email address</label>
    <input class="auth-input" type="email" id="email-input" placeholder="you@example.com" autocomplete="email">
    <button class="auth-btn" id="send-btn" onclick="sendCode()">Send Code ‚Üí</button>
    <p class="auth-skip">No account? <a onclick="navigate('onboarding.html')">Start without one</a></p>
  </div>

  <!-- Step 2: OTP Entry (hidden initially) -->
  <div class="auth-box" id="step-otp" style="display:none">
    <a class="auth-logo" href="index.html"><div class="auth-logo-dot"></div>OneAccord</a>
    <h2 class="auth-h2">Check your email.</h2>
    <p class="auth-sub">We sent a 6-digit code to:</p>
    <div class="auth-email-shown" id="otp-email-label">‚Äî</div>
    <div class="auth-demo-note">üß™ <strong>Demo mode:</strong> Use code <strong>123456</strong> to sign in.</div>
    <label class="auth-label">Enter code</label>
    <div class="otp-inputs">
      <input class="otp-digit" maxlength="1" id="d0" inputmode="numeric">
      <input class="otp-digit" maxlength="1" id="d1" inputmode="numeric">
      <input class="otp-digit" maxlength="1" id="d2" inputmode="numeric">
      <input class="otp-digit" maxlength="1" id="d3" inputmode="numeric">
      <input class="otp-digit" maxlength="1" id="d4" inputmode="numeric">
      <input class="otp-digit" maxlength="1" id="d5" inputmode="numeric">
    </div>
    <button class="auth-btn" id="verify-btn" onclick="verifyCode()">Verify & Sign In ‚Üí</button>
    <p class="auth-resend">Didn't get it? <button onclick="sendCode()">Send again</button></p>
    <p class="auth-skip" style="margin-top:8px;"><a onclick="showEmailStep()">‚Üê Change email</a></p>
  </div>

</div>

<script src="shared.js"></script>
<script>
let pendingEmail = '';
let otpCode = '';

// Redirect if already signed in
if (S.email) {
  const dest = S.stage ? S.stage + '.html' : 'onboarding.html';
  window.location.href = dest;
}

function sendCode() {
  const email = document.getElementById('email-input').value.trim();
  if (!email || !email.includes('@')) { toast('Please enter a valid email address.'); return; }

  const btn = document.getElementById('send-btn');
  btn.disabled = true;
  btn.textContent = 'Sending‚Ä¶';

  pendingEmail = email;
  otpCode = '123456'; // Demo ‚Äî in production: call your backend

  setTimeout(() => {
    document.getElementById('otp-email-label').textContent = email;
    document.getElementById('step-email').style.display = 'none';
    document.getElementById('step-otp').style.display = 'block';
    setTimeout(() => document.getElementById('d0').focus(), 100);
    btn.disabled = false;
    btn.textContent = 'Send Code ‚Üí';
  }, 800);
}

function showEmailStep() {
  document.getElementById('step-otp').style.display = 'none';
  document.getElementById('step-email').style.display = 'block';
}

function verifyCode() {
  const code = [0,1,2,3,4,5].map(i => document.getElementById('d'+i).value).join('');
  if (code.length < 6) { toast('Please enter the full 6-digit code.'); return; }
  if (code !== otpCode) { toast('Invalid code. (Demo: use 123456)'); return; }

  const btn = document.getElementById('verify-btn');
  btn.disabled = true; btn.textContent = 'Signing in‚Ä¶';

  // Save to state
  S.setEmail(pendingEmail);
  const name = pendingEmail.split('@')[0];
  S.setName(name.charAt(0).toUpperCase() + name.slice(1));

  toast('‚úì Signed in!');
  setTimeout(() => {
    const dest = S.stage ? S.stage + '.html' : 'onboarding.html';
    window.location.href = dest;
  }, 700);
}

// OTP digit auto-advance
document.querySelectorAll('.otp-digit').forEach((el, i) => {
  el.addEventListener('input', () => {
    if (el.value && i < 5) document.getElementById('d'+(i+1)).focus();
    if (el.value.length > 1) el.value = el.value.slice(-1);
    // Auto-verify when all 6 filled
    const code = [0,1,2,3,4,5].map(j => document.getElementById('d'+j).value).join('');
    if (code.length === 6) verifyCode();
  });
  el.addEventListener('keydown', e => {
    if (e.key === 'Backspace' && !el.value && i > 0) document.getElementById('d'+(i-1)).focus();
    if (e.key === 'Enter') verifyCode();
  });
});

// Allow pasting full code
document.getElementById('d0').addEventListener('paste', e => {
  const text = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g,'').slice(0,6);
  text.split('').forEach((ch, i) => { const el = document.getElementById('d'+i); if(el) el.value = ch; });
  e.preventDefault();
  if (text.length === 6) verifyCode();
});

document.getElementById('email-input').addEventListener('keydown', e => { if (e.key === 'Enter') sendCode(); });
</script>
</body>
</html>
