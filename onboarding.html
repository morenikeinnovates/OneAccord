<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get Started ‚Äî OneAccord</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Onest:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="shared.css">
<style>
body { background:var(--surface); min-height:100vh; }
.onboard-wrap { max-width:640px;margin:0 auto;padding:60px 24px; }

/* Stage cards */
.stage-cards { display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:36px; }
.stage-card { background:#fff;border:2px solid var(--border);border-radius:16px;padding:24px 16px;text-align:center;cursor:pointer;transition:all .22s; }
.stage-card:hover { border-color:var(--border2);box-shadow:var(--shadow); }
.stage-card.selected { border-color:var(--lime);background:var(--lime-bg); }
.stage-card-emoji { font-size:32px;display:block;margin-bottom:10px; }
.stage-card-name { font-size:16px;font-weight:700;color:var(--ink);margin-bottom:4px; }
.stage-card-hint { font-size:12px;color:var(--muted);line-height:1.4; }

/* Zero steps */
.zero-steps { position:relative; }
.zero-step { display:none; animation:fadeUp .35s ease; }
.zero-step.active { display:block; }

.pdots { display:flex;gap:8px;margin-bottom:36px; }
.pdot { width:8px;height:8px;border-radius:50%;background:var(--border);transition:all .3s; }
.pdot.active { background:var(--ink);width:24px;border-radius:4px; }
.pdot.done { background:var(--lime); }

.how-grid { display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:32px; }
.how-card { background:#fff;border:1px solid var(--border);border-radius:12px;padding:20px 16px;text-align:center; }
.how-num { width:32px;height:32px;border-radius:50%;background:var(--ink);color:#fff;font-size:14px;font-weight:700;display:flex;align-items:center;justify-content:center;margin:0 auto 10px; }
.how-label { font-size:14px;font-weight:700;color:var(--ink);margin-bottom:4px; }
.how-desc { font-size:12px;color:var(--muted);line-height:1.5; }

.z-question { background:#fff;border:1.5px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:20px; }
.z-q-text { font-size:16px;font-weight:600;color:var(--ink);margin-bottom:14px;line-height:1.5; }
.z-input { width:100%;font-family:inherit;font-size:15px;color:var(--ink);background:var(--surface);border:1.5px solid var(--border);border-radius:10px;padding:13px 16px;resize:vertical;min-height:100px;outline:none;transition:border-color .2s;line-height:1.6; }
.z-input:focus { border-color:var(--lime); }

.decl-success { background:var(--ink);border-radius:16px;padding:32px;margin:20px 0;text-align:center; }
.ds-label { font-size:11px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--lime);margin-bottom:16px; }
.ds-text { font-size:18px;font-weight:500;color:#fff;line-height:1.65;font-style:italic; }

/* Email capture */
.email-capture { background:#fff;border:1.5px solid var(--border);border-radius:var(--radius);padding:24px;margin-top:24px; }
.ec-title { font-size:16px;font-weight:700;color:var(--ink);margin-bottom:6px; }
.ec-sub { font-size:13px;color:var(--muted);line-height:1.5;margin-bottom:16px; }
.ec-row { display:flex;gap:10px; }
.ec-input { flex:1;font-family:inherit;font-size:15px;color:var(--ink);background:var(--surface);border:1.5px solid var(--border);border-radius:10px;padding:12px 14px;outline:none;transition:border-color .2s; }
.ec-input:focus { border-color:var(--lime); }
.ec-btn { background:var(--ink);color:#fff;border:none;font-family:inherit;font-size:14px;font-weight:600;padding:12px 20px;border-radius:10px;cursor:pointer;white-space:nowrap;transition:all .2s; }
.ec-btn:hover { background:var(--ink2); }
.ec-skip { display:block;text-align:center;margin-top:12px;font-size:13px;color:var(--muted);background:none;border:none;font-family:inherit;cursor:pointer;width:100%; }
.ec-skip:hover { color:var(--ink); }

@media(max-width:600px){
  .onboard-wrap { padding:32px 16px 60px; }
  .stage-cards { grid-template-columns:1fr;gap:10px; }
  .how-grid { grid-template-columns:1fr;gap:10px; }
  .ec-row { flex-direction:column; }
  .ec-input,.ec-btn { width:100%; }
}
</style>
</head>
<body>

<nav class="top-nav">
  <a class="nav-logo" href="index.html"><div class="nav-logo-dot"></div>OneAccord</a>
  <div id="nav-user" class="nav-user" style="margin-left:auto;display:none;">
    <span class="nav-user-name" id="nav-name"></span>
    <button class="nav-profile-btn" id="nav-initial" onclick="navigate('profile.html')"></button>
  </div>
</nav>

<div class="onboard-wrap">

  <!-- STAGE SELECTION -->
  <div id="view-stage" class="zero-step active">
    <div class="page-eyebrow">Getting started</div>
    <h1 class="page-h1">Where are you<br>in your relationship?</h1>
    <p class="page-sub">Your stage shapes your recommended session path. You can always change this later.</p>
    <div class="stage-cards">
      <div class="stage-card" onclick="selectStage('dating',this)">
        <span class="stage-card-emoji">üå±</span>
        <div class="stage-card-name">Dating</div>
        <div class="stage-card-hint">Exploring, building something intentional.</div>
      </div>
      <div class="stage-card" onclick="selectStage('engaged',this)">
        <span class="stage-card-emoji">üíç</span>
        <div class="stage-card-name">Engaged</div>
        <div class="stage-card-hint">Preparing for the covenant of marriage.</div>
      </div>
      <div class="stage-card" onclick="selectStage('married',this)">
        <span class="stage-card-emoji">üïäÔ∏è</span>
        <div class="stage-card-name">Married</div>
        <div class="stage-card-hint">Going deeper, building a lasting foundation.</div>
      </div>
    </div>
    <button class="btn-dark" id="stage-cta" style="width:100%;opacity:.35;pointer-events:none" onclick="goToZero()">
      Begin Session Zero ‚Üí
    </button>
  </div>

  <!-- SESSION ZERO -->
  <div id="view-zero" class="zero-step">
    <div class="pdots" id="pdots">
      <div class="pdot active" id="pd1"></div>
      <div class="pdot" id="pd2"></div>
      <div class="pdot" id="pd3"></div>
      <div class="pdot" id="pd4"></div>
    </div>

    <!-- Step 1 -->
    <div class="zero-step active" id="zs1">
      <div class="page-eyebrow">Session Zero</div>
      <h1 class="page-h1">Before you begin,<br>understand the structure.</h1>
      <p class="page-sub">Every session moves through four phases. Here's how it works.</p>
      <div class="how-grid">
        <div class="how-card"><div class="how-num">1</div><div class="how-label">My Story</div><div class="how-desc">Private reflection on your own experience. Yours alone.</div></div>
        <div class="how-card"><div class="how-num">2</div><div class="how-label">Your Story</div><div class="how-desc">What you observe and understand about your partner.</div></div>
        <div class="how-card"><div class="how-num">3</div><div class="how-label">Find Our Middle</div><div class="how-desc">From two views to one shared position.</div></div>
      </div>
      <button class="btn-dark" style="width:100%" onclick="zeroStep(2)">Continue ‚Üí</button>
    </div>

    <!-- Step 2 -->
    <div class="zero-step" id="zs2">
      <div class="page-eyebrow">My Story ‚Äî Your turn first</div>
      <h1 class="page-h1">Reflect before you share.</h1>
      <div class="z-question">
        <p class="z-q-text">What is the one thing you most want this relationship to be defined by ‚Äî above everything else?</p>
        <textarea class="z-input" id="zero-q1" placeholder="Write your reflection here ‚Äî this is just for you‚Ä¶"></textarea>
      </div>
      <button class="btn-dark" style="width:100%" onclick="zeroStep(3)">Continue ‚Üí</button>
    </div>

    <!-- Step 3 -->
    <div class="zero-step" id="zs3">
      <div class="page-eyebrow">Your Story ‚Äî Now understand them</div>
      <h1 class="page-h1">What do you know about<br>your partner?</h1>
      <div class="z-question">
        <p class="z-q-text">What do you think your partner most wants this relationship to be defined by?</p>
        <textarea class="z-input" id="zero-q2" placeholder="Your observation of who they are‚Ä¶"></textarea>
      </div>
      <button class="btn-dark" style="width:100%" onclick="generateDeclaration()">Generate My First Declaration ‚Üí</button>
    </div>

    <!-- Step 4 -->
    <div class="zero-step" id="zs4">
      <div class="page-eyebrow">Your First Declaration</div>
      <h1 class="page-h1" style="text-align:center">Here it is.</h1>
      <div class="decl-success">
        <div class="ds-label">‚ú¶ Your Declaration</div>
        <div class="ds-text" id="decl-text">Generating‚Ä¶</div>
      </div>
      <p class="page-sub" style="text-align:center;margin-top:12px;">This is what a declaration looks like. Every session ends with one ‚Äî written in your own words, sealed permanently into your shared archive.</p>

      <div id="email-capture-wrap">
        <div class="email-capture" id="email-capture-box">
          <div class="ec-title">Save your progress?</div>
          <div class="ec-sub">Enter your email to preserve your declarations across sessions and devices ‚Äî no password, ever.</div>
          <div class="ec-row">
            <input class="ec-input" type="email" id="capture-email" placeholder="your@email.com">
            <button class="ec-btn" onclick="saveEmailCapture()">Save ‚Üí</button>
          </div>
          <button class="ec-skip" onclick="skipEmail()">Skip for now</button>
        </div>
      </div>

      <button class="btn-dark" id="enter-library-btn" style="width:100%;display:none;margin-top:20px" onclick="enterLibrary()">
        Enter Session Library ‚Üí
      </button>
    </div>
  </div>

</div>

<script src="shared.js"></script>
<script>
let currentStage = null;
let zeroStepNum = 1;
const ZERO_STEPS = 4;

// Init nav
window.addEventListener('load', () => {
  if (S.email) {
    document.getElementById('nav-user').style.display = 'flex';
    document.getElementById('nav-name').textContent = S.userName || S.email;
    document.getElementById('nav-initial').textContent = (S.userName || S.email).charAt(0).toUpperCase();
    // Hide email capture if already signed in
    document.getElementById('email-capture-wrap').style.display = 'none';
    document.getElementById('enter-library-btn').style.display = 'block';
  }
  // If already has a stage, skip to zero
  if (S.stage) {
    currentStage = S.stage;
    showView('view-zero');
  }
});

function selectStage(stage, el) {
  currentStage = stage;
  document.querySelectorAll('.stage-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  const cta = document.getElementById('stage-cta');
  cta.style.opacity = '1';
  cta.style.pointerEvents = 'auto';
}

function goToZero() {
  if (!currentStage) return;
  S.setStage(currentStage);
  showView('view-zero');
}

function showView(id) {
  document.querySelectorAll('#view-stage,#view-zero').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}

function zeroStep(n) {
  document.getElementById('zs'+zeroStepNum).classList.remove('active');
  zeroStepNum = n;
  document.getElementById('zs'+n).classList.add('active');
  // Update dots
  for (let i=1; i<=ZERO_STEPS; i++) {
    const dot = document.getElementById('pd'+i);
    if (!dot) continue;
    dot.className = 'pdot' + (i < n ? ' done' : i === n ? ' active' : '');
  }
  window.scrollTo(0,0);
}

async function generateDeclaration() {
  const q1 = (document.getElementById('zero-q1').value||'').trim();
  const q2 = (document.getElementById('zero-q2').value||'').trim();

  zeroStep(4);
  document.getElementById('decl-text').textContent = '‚ú¶ Crafting your declaration‚Ä¶';

  const fallback = "We agree that this relationship should be defined by faith, honesty, and the willingness to always choose each other.";

  try {
    const ai = await aiDeclaration({ q1, q2 });
    document.getElementById('decl-text').textContent = '"' + (ai || fallback) + '"';
  } catch(e) {
    document.getElementById('decl-text').textContent = '"' + fallback + '"';
  }

  if (S.email) {
    document.getElementById('email-capture-wrap').style.display = 'none';
    document.getElementById('enter-library-btn').style.display = 'block';
  }
}

function saveEmailCapture() {
  const email = (document.getElementById('capture-email').value||'').trim();
  if (!email || !email.includes('@')) { toast('Please enter a valid email.'); return; }
  S.setEmail(email);
  const name = email.split('@')[0];
  S.setName(name.charAt(0).toUpperCase() + name.slice(1));
  document.getElementById('email-capture-box').style.display = 'none';
  document.getElementById('enter-library-btn').style.display = 'block';
  toast('‚úì Progress saved!');
}

function skipEmail() {
  document.getElementById('email-capture-box').style.display = 'none';
  document.getElementById('enter-library-btn').style.display = 'block';
}

function enterLibrary() {
  const stage = S.stage || currentStage || 'dating';
  window.location.href = stage + '.html';
}
</script>
</body>
</html>
