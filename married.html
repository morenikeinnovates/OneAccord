<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Married Sessions ‚Äî OneAccord</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Onest:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="shared.css">
<style>
/* ‚îÄ‚îÄ LIBRARY ‚îÄ‚îÄ */
.lib-wrap { flex:1;padding:32px 40px;max-width:1100px;margin:0 auto;width:100%; }
.lib-top { display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:12px; }
.stage-pill { display:inline-flex;align-items:center;gap:8px;background:var(--lime-bg);border:1px solid #c8e87a;padding:5px 14px;border-radius:100px;font-size:13px;font-weight:700;color:#4a6b1a; }
.other-stages { font-size:13px;color:var(--muted); }
.other-stages a { color:var(--muted);text-decoration:underline;cursor:pointer; }
.other-stages a:hover { color:var(--ink); }

/* Couple banners */
.couple-banner { display:flex;align-items:center;gap:14px;background:var(--lime-bg);border:1.5px solid #c8e87a;border-radius:var(--radius);padding:16px 20px;margin-bottom:20px; }
.cb-icon { font-size:24px; }
.cb-text { flex:1; }
.cb-title { font-size:15px;font-weight:700;color:var(--ink);margin-bottom:2px; }
.cb-sub { font-size:13px;color:var(--muted); }
.connect-cta { display:flex;align-items:center;gap:14px;background:var(--surface);border:1.5px dashed var(--border2);border-radius:var(--radius);padding:16px 20px;cursor:pointer;margin-bottom:20px;transition:all .2s; }
.connect-cta:hover { border-color:var(--ink);background:#fff; }
.connect-cta-icon { font-size:20px; }
.connect-cta-text { flex:1; }
.connect-cta-title { font-size:14px;font-weight:700;color:var(--ink);margin-bottom:2px; }
.connect-cta-sub { font-size:12px;color:var(--muted);line-height:1.4; }
.connect-cta-arrow { font-size:18px;color:var(--muted); }

/* Recommended path */
.rec-section { margin-bottom:28px; }
.rec-heading { font-size:12px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--subtle);margin-bottom:12px;display:flex;align-items:center;gap:10px; }
.rec-heading::after { content:'';flex:1;height:1px;background:var(--border); }
.rec-path { display:flex;gap:10px;flex-wrap:wrap; }
.rec-step { background:#fff;border:1.5px solid var(--border);border-radius:10px;padding:10px 16px;font-size:13px;font-weight:600;color:var(--muted);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:8px; }
.rec-step:hover { border-color:var(--ink);color:var(--ink); }
.rec-step.done { background:var(--lime-bg);border-color:#c8e87a;color:#4a6b1a; }

/* Category grid */
.all-cats-heading { font-size:12px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--subtle);margin-bottom:16px;margin-top:32px;display:flex;align-items:center;gap:10px; }
.all-cats-heading::after { content:'';flex:1;height:1px;background:var(--border); }
.cat-grid { display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:14px; }
.cat-card { background:#fff;border:1.5px solid var(--border);border-radius:var(--radius);padding:22px 18px;cursor:pointer;transition:all .22s;position:relative; }
.cat-card:hover { border-color:var(--border2);box-shadow:var(--shadow);transform:translateY(-2px); }
.cat-done-badge { position:absolute;top:12px;right:12px;background:var(--lime);color:#2a4010;font-size:10px;font-weight:700;padding:2px 7px;border-radius:100px; }
.cat-emoji { font-size:22px;display:block;margin-bottom:10px; }
.cat-name { font-size:15px;font-weight:700;color:var(--ink);margin-bottom:3px; }
.cat-count { font-size:12px;color:var(--muted);margin-bottom:10px; }
.cat-bar { height:3px;background:var(--border);border-radius:2px;overflow:hidden; }
.cat-bar-fill { height:100%;background:var(--lime);border-radius:2px;transition:width .4s; }

/* ‚îÄ‚îÄ PICKER ‚îÄ‚îÄ */
.picker-wrap { flex:1;padding:48px 32px;max-width:700px;margin:0 auto;width:100%; }
.sess-list { width:100%;margin-bottom:28px; }
.sess-item { background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:18px 20px;margin-bottom:10px;cursor:pointer;transition:all .22s; }
.sess-item:hover,.sess-item.selected { border-color:var(--ink);background:#fff;box-shadow:var(--shadow); }
.sess-item.selected { border-color:var(--lime);background:var(--lime-bg); }
.sess-item-top { display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:8px; }
.sess-title { font-size:16px;font-weight:700;color:var(--ink);margin-bottom:2px; }
.sess-sub { font-size:13px;color:var(--muted); }
.sess-item-meta { display:flex;align-items:center;gap:8px;flex-wrap:wrap; }
.attempts-link { font-size:11px;color:var(--muted);cursor:pointer;text-decoration:underline;background:none;border:none;font-family:inherit; }
.attempts-link:hover { color:var(--ink); }
.do-again-btn { font-size:11px;font-weight:600;color:var(--lime);background:none;border:none;cursor:pointer;font-family:inherit;margin-left:auto; }
.attempts-panel { margin-top:10px;padding-top:10px;border-top:1px solid var(--border); }
.attempt-item { padding:10px 0;border-bottom:1px solid var(--border); }
.attempt-item:last-child { border-bottom:none; }
.attempt-meta { display:flex;align-items:center;gap:8px;margin-bottom:4px; }
.attempt-date { font-size:12px;font-weight:600;color:var(--muted); }
.attempt-mode { font-size:11px;color:var(--subtle); }
.attempt-decl { font-size:13px;color:var(--ink);line-height:1.5;font-style:italic; }

.mode-label { font-size:12px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--subtle);margin-bottom:14px; }
.mode-grid { display:grid;grid-template-columns:1fr 1fr;gap:14px;width:100%;margin-bottom:32px; }
.mode-card { border:1.5px solid var(--border);border-radius:var(--radius);padding:22px 20px;cursor:pointer;transition:all .22s;background:#fff; }
.mode-card:hover { border-color:var(--border2);box-shadow:var(--shadow); }
.mode-card.selected { border-color:var(--ink);background:var(--ink); }
.mode-card.selected .mode-name { color:#fff; }
.mode-card.selected .mode-time { color:var(--lime); }
.mode-card.selected .mode-desc { color:rgba(255,255,255,.55); }
.mode-icon { font-size:24px;margin-bottom:10px; }
.mode-name { font-size:16px;font-weight:700;color:var(--ink);margin-bottom:4px; }
.mode-time { font-size:12px;font-weight:600;color:var(--lime);margin-bottom:8px; }
.mode-desc { font-size:13px;color:var(--muted);line-height:1.5; }

/* ‚îÄ‚îÄ DEEP SESSION ‚îÄ‚îÄ */
#view-session-deep { background:#fff; }
.deep-topbar { background:#fff;border-bottom:1px solid var(--border);padding:0 40px;height:48px;display:flex;align-items:center;gap:20px;position:sticky;top:60px;z-index:50; }
.deep-cat { font-size:13px;font-weight:600;color:var(--muted); }
.deep-prog-row { display:flex;gap:5px;flex:1;justify-content:center; }
.deep-step-lbl { font-size:12px;color:var(--subtle);min-width:50px;text-align:right; }
.sess-body { flex:1;max-width:740px;margin:0 auto;width:100%;padding:48px 32px; }
.sec-title { font-size:clamp(24px,4vw,36px);font-weight:800;letter-spacing:-.5px;color:var(--ink);line-height:1.15;margin-bottom:24px; }
.why-para { font-size:16px;color:var(--muted);line-height:1.8;margin-bottom:16px; }
.couple-sync-note { background:var(--amber-bg);border:1px solid #f0cc80;border-radius:10px;padding:14px 18px;margin-bottom:20px;font-size:13px;color:#8a5a00;line-height:1.5; }

/* ‚îÄ‚îÄ FLASH SESSION ‚îÄ‚îÄ */
#view-session-flash { background:var(--surface); }
.flash-wrap { flex:1;display:flex;flex-direction:column;align-items:center;padding:32px 24px;max-width:700px;margin:0 auto;width:100%; }
.flash-counter { font-size:13px;font-weight:600;color:var(--muted);margin-bottom:28px; }
.flashcard-scene { width:100%;perspective:1000px;margin-bottom:28px;cursor:pointer; }
.flashcard { width:100%;min-height:280px;position:relative;transform-style:preserve-3d;transition:transform .5s ease;border-radius:20px; }
.flashcard.flipped { transform:rotateY(180deg); }
.fc-face { position:absolute;inset:0;backface-visibility:hidden;border-radius:20px;padding:36px;display:flex;flex-direction:column; }
.fc-front { background:var(--ink);color:#fff;align-items:center;justify-content:center;text-align:center; }
.fc-back { background:var(--lime-bg);border:1.5px solid #c8e87a;transform:rotateY(180deg);align-items:flex-start; }
.fc-tag { font-size:11px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--lime);margin-bottom:20px; }
.fc-back .fc-tag { color:#4a6b1a; }
.fc-question { font-size:22px;font-weight:700;color:#fff;line-height:1.4; }
.fc-hint { font-size:13px;color:rgba(255,255,255,.4);margin-top:auto; }
.fc-answer-label { font-size:13px;font-weight:700;color:#4a6b1a;margin-bottom:12px; }
.fc-prompt { font-size:15px;color:var(--ink2);line-height:1.6;font-style:italic; }
.flash-btns { display:flex;gap:12px;width:100%;justify-content:center; }
.flash-decl-section { width:100%;margin-top:24px; }
.flash-decl-block { background:var(--ink);border-radius:var(--radius);padding:32px;margin:20px 0; }
.fdb-preamble { font-size:11px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--lime);margin-bottom:14px; }
.fdb-preamble-big { font-size:22px;font-weight:700;color:var(--lime);font-style:italic;display:block;margin-bottom:8px; }
.fdb-field { width:100%;font-family:inherit;font-size:17px;font-weight:500;font-style:italic;color:#fff;background:transparent;border:none;border-bottom:1.5px solid rgba(255,255,255,.15);padding:10px 0;resize:none;min-height:90px;line-height:1.7;outline:none;transition:border-color .2s; }
.fdb-field::placeholder { color:rgba(255,255,255,.2); }
.fdb-field:focus { border-bottom-color:var(--lime); }

/* ‚îÄ‚îÄ CONFIRM ‚îÄ‚îÄ */
#view-confirm { background:#fff; }
.confirm-body { flex:1;display:flex;flex-direction:column;align-items:center;padding:80px 24px;text-align:center; }
.confirm-icon { width:72px;height:72px;border-radius:50%;background:var(--lime);font-size:32px;display:flex;align-items:center;justify-content:center;margin-bottom:24px; }
.confirm-h2 { font-size:36px;font-weight:800;letter-spacing:-.5px;color:var(--ink);margin-bottom:12px; }
.confirm-sub { font-size:16px;color:var(--muted);line-height:1.6;max-width:440px;margin-bottom:32px; }
.confirm-decl-card { background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:28px;max-width:540px;width:100%;margin-bottom:32px; }
.confirm-decl-label { font-size:11px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--lime);margin-bottom:14px; }
.confirm-decl-text { font-size:18px;color:var(--ink);line-height:1.65;font-style:italic;font-weight:500; }
.confirm-btns { display:flex;gap:12px;justify-content:center;flex-wrap:wrap; }
.confirm-email-capture { background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:24px;max-width:440px;width:100%;margin-bottom:24px; }
.cec-title { font-size:16px;font-weight:700;margin-bottom:6px; }
.cec-sub { font-size:13px;color:var(--muted);line-height:1.5;margin-bottom:16px; }
.cec-row { display:flex;gap:10px; }
.cec-input { flex:1;font-family:inherit;font-size:14px;color:var(--ink);background:#fff;border:1.5px solid var(--border);border-radius:10px;padding:11px 14px;outline:none;transition:border-color .2s; }
.cec-input:focus { border-color:var(--lime); }
.cec-btn { background:var(--ink);color:#fff;border:none;font-family:inherit;font-size:14px;font-weight:600;padding:11px 18px;border-radius:10px;cursor:pointer;white-space:nowrap; }
.cec-skip { display:block;text-align:center;margin-top:12px;font-size:13px;color:var(--muted);background:none;border:none;font-family:inherit;cursor:pointer;width:100%; }

/* ‚îÄ‚îÄ DECLARATIONS ‚îÄ‚îÄ */
.decls-wrap { flex:1;padding:32px 40px;max-width:800px;margin:0 auto;width:100%; }
.decl-item { background:#fff;border:1.5px solid var(--border);border-radius:var(--radius);padding:24px;margin-bottom:14px;transition:box-shadow .2s; }
.decl-item:hover { box-shadow:var(--shadow); }
.di-cat { font-size:12px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;color:var(--muted);margin-bottom:6px; }
.di-title { font-size:18px;font-weight:700;color:var(--ink);margin-bottom:10px; }
.di-text { font-size:16px;color:var(--ink2);line-height:1.65;font-style:italic;margin-bottom:12px; }
.di-footer { display:flex;align-items:center;gap:12px;flex-wrap:wrap; }
.di-date { font-size:12px;color:var(--subtle); }
.empty-state { text-align:center;padding:80px 24px; }
.empty-icon { font-size:48px;margin-bottom:16px; }
.empty-title { font-size:22px;font-weight:700;color:var(--ink);margin-bottom:8px; }
.empty-sub { font-size:15px;color:var(--muted); }

/* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
.progress-wrap { flex:1;padding:32px 40px;max-width:1000px;margin:0 auto;width:100%; }
.prog-hero { background:var(--ink);border-radius:20px;padding:36px 40px;margin-bottom:28px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:24px; }
.ph-stat { text-align:center; }
.ph-num { font-size:48px;font-weight:800;color:var(--lime);line-height:1;margin-bottom:6px;letter-spacing:-1px; }
.ph-label { font-size:12px;font-weight:600;color:rgba(255,255,255,.5);letter-spacing:.06em;text-transform:uppercase; }
.prog-section-title { font-size:12px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--subtle);margin-bottom:16px;display:flex;align-items:center;gap:10px; }
.prog-section-title::after { content:'';flex:1;height:1px;background:var(--border); }
.prog-cat-grid { display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-bottom:36px; }
.prog-cat-item { background:#fff;border:1.5px solid var(--border);border-radius:12px;padding:18px; }
.pci-emoji { font-size:20px;display:block;margin-bottom:8px; }
.pci-name { font-size:14px;font-weight:700;color:var(--ink);margin-bottom:4px; }
.pci-count { font-size:12px;color:var(--muted);margin-bottom:10px; }
.pci-bar { height:3px;background:var(--border);border-radius:2px;overflow:hidden; }
.pci-bar-fill { height:100%;background:var(--lime);border-radius:2px; }
.pci-complete { color:var(--lime);font-size:12px;font-weight:700;margin-top:6px; }
.timeline-list { display:flex;flex-direction:column;gap:10px;margin-bottom:40px; }
.timeline-item { background:#fff;border:1.5px solid var(--border);border-radius:12px;padding:16px 20px;display:flex;align-items:center;gap:16px; }
.tl-icon { width:36px;height:36px;border-radius:9px;background:var(--lime-bg);border:1px solid #c8e87a;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0; }
.tl-body { flex:1;min-width:0; }
.tl-title { font-size:14px;font-weight:700;color:var(--ink);margin-bottom:2px; }
.tl-sub { font-size:12px;color:var(--muted); }
.tl-date { font-size:11px;color:var(--subtle);text-align:right;flex-shrink:0; }

/* ‚îÄ‚îÄ COUPLE SCREEN ‚îÄ‚îÄ */
.couple-wrap { flex:1;display:flex;flex-direction:column;align-items:center;padding:60px 24px;max-width:640px;margin:0 auto;width:100%; }
.invite-code-box { background:var(--surface);border:2px dashed var(--border2);border-radius:16px;padding:32px;text-align:center;margin:24px 0;width:100%; }
.icb-label { font-size:12px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);margin-bottom:16px; }
.icb-code { font-size:44px;font-weight:800;letter-spacing:8px;color:var(--ink);margin-bottom:14px; }
.icb-expiry { font-size:12px;color:var(--subtle);margin-bottom:20px; }
.partner-list { width:100%; }
.partner-row { background:#fff;border:1.5px solid var(--border);border-radius:var(--radius);padding:18px 20px;display:flex;align-items:center;gap:14px;margin-bottom:10px; }
.partner-avatar { width:40px;height:40px;border-radius:50%;background:var(--ink);color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;flex-shrink:0; }
.partner-b { background:#4a8aff; }
.partner-info { flex:1; }
.partner-name { font-size:15px;font-weight:700;color:var(--ink); }
.partner-email { font-size:12px;color:var(--muted);margin-top:1px; }
.enter-code-section { width:100%;margin-top:28px; }
.enter-code-title { font-size:15px;font-weight:700;margin-bottom:14px; }

/* ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ */
.profile-wrap { flex:1;padding:40px;max-width:680px;margin:0 auto;width:100%; }
.prof-section-title { font-size:12px;font-weight:700;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);margin-bottom:16px; }
.prof-row { display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border);gap:12px; }
.prof-row:last-child { border-bottom:none; }
.prof-label { font-size:14px;font-weight:600;color:var(--ink); }
.prof-value { font-size:14px;color:var(--muted);flex:1; }

/* ‚îÄ‚îÄ NAV TABS ‚îÄ‚îÄ */
.lib-tab { margin-left:auto; }

/* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
@media(max-width:860px){
  .lib-wrap,.decls-wrap,.progress-wrap { padding:24px 20px; }
  .picker-wrap { padding:28px 20px; }
  .profile-wrap { padding:24px 20px; }
  .deep-topbar { padding:0 20px; }
  .sess-body { padding:36px 20px; }
}
@media(max-width:600px){
  .lib-wrap,.decls-wrap,.progress-wrap { padding:16px 14px 84px; }
  .profile-wrap { padding:16px 14px 84px; }
  .picker-wrap { padding:20px 14px; }
  .cat-grid { grid-template-columns:1fr 1fr;gap:10px; }
  .cat-card { padding:16px 12px; }
  .cat-name { font-size:13px; }
  .mode-grid { grid-template-columns:1fr; }
  .deep-topbar { padding:0 14px;top:54px;height:44px; }
  .deep-cat { display:none; }
  .sess-body { padding:24px 14px 88px; }
  .sec-title { font-size:22px; }
  .prog-hero { padding:20px;gap:8px; }
  .ph-num { font-size:30px; }
  .ph-label { font-size:9px; }
  .prog-cat-grid { grid-template-columns:1fr 1fr;gap:8px; }
  .timeline-item { padding:12px 14px;gap:10px; }
  .confirm-body { padding:40px 16px; }
  .confirm-h2 { font-size:26px; }
  .confirm-btns { flex-direction:column; }
  .cec-row { flex-direction:column; }
  .couple-wrap { padding:28px 14px; }
  .icb-code { font-size:32px;letter-spacing:4px; }
  .decl-item { padding:18px 14px; }
  .di-text { font-size:14px; }
  .flash-wrap { padding:20px 14px; }
  .flashcard { min-height:220px; }
  .fc-face { padding:24px 18px; }
  .fc-question { font-size:18px; }
  .flash-btns { gap:8px; }
}
</style>
</head>
<body>

<!-- TOP NAV -->
<nav class="top-nav" id="top-nav">
  <a class="nav-logo" href="index.html"><div class="nav-logo-dot"></div>OneAccord</a>

  <!-- Library tabs (shown on lib views) -->
  <div class="nav-tabs" id="nav-lib-tabs">
    <button class="nav-tab active" data-tab="library"     onclick="showView('library')">Sessions</button>
    <button class="nav-tab"        data-tab="declarations" onclick="showView('declarations')">Declarations</button>
    <button class="nav-tab"        data-tab="progress"    onclick="showView('progress')">Progress</button>
  </div>

  <!-- Session back (shown in session views) -->
  <button class="nav-back" id="nav-back" style="display:none" onclick="goBackFromSession()">‚Üê Exit</button>

  <div class="nav-user" id="nav-user">
    <span class="nav-user-name" id="nav-name"></span>
    <button class="nav-profile-btn" id="nav-initial" onclick="showView('profile')"></button>
  </div>
</nav>

<!-- ‚ïê‚ïê LIBRARY VIEW ‚ïê‚ïê -->
<div class="view" id="view-library" style="display:flex;flex-direction:column">
  <div class="lib-wrap">
    <div class="lib-top">
      <span class="stage-pill" id="stage-pill">üïäÔ∏è Married</span>
      <span class="other-stages">Also: <a href="dating.html">üå± Dating</a> ¬∑ <a href="engaged.html">üíç Engaged</a></span>
    </div>
    <div class="couple-banner" id="couple-banner" style="display:none">
      <div class="cb-icon">üîó</div>
      <div class="cb-text">
        <div class="cb-title">Connected with <span class="cb-name"></span></div>
        <div class="cb-sub">Couple Space active ‚Äî sessions now track both of you.</div>
      </div>
      <button class="btn-ghost" style="padding:8px 14px;font-size:13px" onclick="showView('couple')">Manage</button>
    </div>
    <div class="connect-cta" id="connect-cta" onclick="showView('couple')" style="display:none">
      <div class="connect-cta-icon">üîó</div>
      <div class="connect-cta-text">
        <div class="connect-cta-title">Connect with your partner</div>
        <div class="connect-cta-sub">Link two accounts so you can both engage sessions independently.</div>
      </div>
      <div class="connect-cta-arrow">‚Üí</div>
    </div>
    <div class="rec-section">
      <div class="rec-heading">Recommended path</div>
      <div class="rec-path" id="rec-path"></div>
    </div>
    <div class="all-cats-heading">All categories</div>
    <div class="cat-grid" id="cat-grid"></div>
  </div>
</div>

<!-- ‚ïê‚ïê SESSION PICKER VIEW ‚ïê‚ïê -->
<div class="view" id="view-session-picker" style="display:none">
  <div class="picker-wrap">
    <div style="text-align:center;margin-bottom:8px;font-size:28px" id="pick-cat-emoji"></div>
    <h1 class="page-h1" style="text-align:center" id="pick-cat-name"></h1>
    <p class="page-sub" style="text-align:center" id="pick-cat-desc"></p>
    <div class="sess-list" id="sess-list"></div>
    <div class="mode-label">Choose your mode</div>
    <div class="mode-grid">
      <div class="mode-card" id="mode-deep" onclick="selectMode('deep',this)">
        <div class="mode-icon">üìñ</div>
        <div class="mode-name">Deep Session</div>
        <div class="mode-time">45‚Äì60 min</div>
        <div class="mode-desc">Full structured conversation ‚Äî prayer, reflection, finding your middle, and declaring together.</div>
      </div>
      <div class="mode-card" id="mode-flash" onclick="selectMode('flash',this)">
        <div class="mode-icon">‚ö°</div>
        <div class="mode-name">Flashcards</div>
        <div class="mode-time">15‚Äì20 min</div>
        <div class="mode-desc">Quick-fire questions to spark conversation. Best for revisiting or when time is short.</div>
      </div>
    </div>
    <button class="btn-dark" id="begin-btn" style="width:100%;opacity:.35;pointer-events:none" onclick="beginSession()">Begin Session ‚Üí</button>
  </div>
</div>

<!-- ‚ïê‚ïê DEEP SESSION VIEW ‚ïê‚ïê -->
<div class="view" id="view-session-deep" style="display:none">
  <div class="deep-topbar">
    <span class="deep-cat" id="deep-cat-label"></span>
    <div class="deep-prog-row seg-row" id="deep-prog"></div>
    <span class="deep-step-lbl" id="deep-step-label"></span>
  </div>
  <div id="deep-body" style="flex:1;overflow-y:auto"></div>
</div>

<!-- ‚ïê‚ïê FLASH SESSION VIEW ‚ïê‚ïê -->
<div class="view" id="view-session-flash" style="display:none">
  <div class="flash-wrap">
    <div class="seg-row" id="flash-prog" style="width:100%;margin-bottom:24px"></div>
    <div class="flash-counter" id="flash-counter">Card 1</div>
    <div class="flashcard-scene" onclick="flipCard()">
      <div class="flashcard" id="flashcard">
        <div class="fc-face fc-front">
          <div class="fc-tag">Question</div>
          <div class="fc-question" id="fc-question">Loading‚Ä¶</div>
          <div class="fc-hint">Tap to flip</div>
        </div>
        <div class="fc-face fc-back">
          <div class="fc-tag">Talk about it</div>
          <div class="fc-answer-label">Share with your partner:</div>
          <div class="fc-prompt" id="fc-prompt"></div>
        </div>
      </div>
    </div>
    <div class="flash-btns">
      <button class="btn-ghost" onclick="flashPrev()">‚Üê Prev</button>
      <button class="btn-dark" id="flash-next-btn" onclick="flashNext()">Next Card ‚Üí</button>
    </div>
    <div id="flash-decl-section" style="display:none;width:100%">
      <div class="flash-decl-block">
        <div class="fdb-preamble">‚ú¶ Write Your Declaration</div>
        <p style="font-size:14px;color:rgba(255,255,255,.55);margin-bottom:14px;line-height:1.6">Based on your conversation ‚Äî what do you agree on?</p>
        <span class="fdb-preamble-big">We agree that‚Ä¶</span>
        <textarea class="fdb-field" id="flash-decl-input" placeholder="‚Ä¶write your shared declaration here. Or leave blank and we'll craft one."></textarea>
      </div>
      <button class="btn-lime" style="width:100%;margin-top:16px" onclick="sealFlashDeclaration()">Seal This Declaration ‚ú¶</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê CONFIRM VIEW ‚ïê‚ïê -->
<div class="view" id="view-confirm" style="display:none">
  <div class="confirm-body">
    <div class="confirm-icon">‚ú¶</div>
    <h2 class="confirm-h2">Declaration sealed.</h2>
    <p class="confirm-sub">This is now part of your permanent shared archive. Return to it, reflect on it, build on it.</p>
    <div class="confirm-decl-card">
      <div class="confirm-decl-label">‚ú¶ Your Declaration</div>
      <div class="confirm-decl-text" id="confirm-text"></div>
    </div>
    <div class="confirm-email-capture" id="confirm-email-capture" style="display:none">
      <div class="cec-title">Save your declaration?</div>
      <div class="cec-sub">This is the first entry in your shared archive. Enter your email to save it permanently.</div>
      <div class="cec-row">
        <input class="cec-input" type="email" id="confirm-email-inp" placeholder="your@email.com">
        <button class="cec-btn" onclick="saveConfirmEmail()">Save ‚Üí</button>
      </div>
      <button class="cec-skip" onclick="document.getElementById('confirm-email-capture').style.display='none'">Skip</button>
    </div>
    <div class="confirm-btns">
      <button class="btn-dark" onclick="showView('library')">Back to Sessions</button>
      <button class="btn-outline" onclick="showView('declarations')">View All Declarations</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê DECLARATIONS VIEW ‚ïê‚ïê -->
<div class="view" id="view-declarations" style="display:none">
  <div class="decls-wrap">
    <div class="lib-top" style="margin-bottom:24px"><h2 style="font-size:24px;font-weight:800;letter-spacing:-.5px">Your Declarations</h2></div>
    <div id="decls-list"></div>
  </div>
</div>

<!-- ‚ïê‚ïê PROGRESS VIEW ‚ïê‚ïê -->
<div class="view" id="view-progress" style="display:none">
  <div class="progress-wrap" id="progress-wrap"></div>
</div>

<!-- ‚ïê‚ïê COUPLE SYNC VIEW ‚ïê‚ïê -->
<div class="view" id="view-couple" style="display:none">
  <div class="couple-wrap">
    <div class="page-eyebrow">Couple Sync</div>
    <h1 class="page-h1" style="text-align:center">Connect with your partner.</h1>
    <p class="page-sub" style="text-align:center">Link two OneAccord accounts. Each partner uses their own device.</p>
    <div id="couple-content" style="width:100%"></div>
    <div class="enter-code-section" id="enter-code-section" style="display:none">
      <div class="enter-code-title">Have an invite code from your partner?</div>
      <div style="display:flex;gap:10px">
        <input class="field" type="text" id="enter-code-input" placeholder="ABC123" maxlength="6"
          style="letter-spacing:4px;font-size:18px;font-weight:700;text-transform:uppercase;text-align:center">
        <button class="btn-dark" style="white-space:nowrap" onclick="submitInviteCode()">Join ‚Üí</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê PROFILE VIEW ‚ïê‚ïê -->
<div class="view" id="view-profile" style="display:none">
  <div class="profile-wrap" id="profile-wrap"></div>
</div>

<!-- Mobile Bottom Nav -->
<div class="mob-nav" id="mob-nav" style="display:none">
  <button class="mob-nav-item active" data-tab="sessions"    onclick="showView('library')">
    <span class="mob-nav-icon">üìö</span><span class="mob-nav-label">Sessions</span>
  </button>
  <button class="mob-nav-item" data-tab="archive"    onclick="showView('declarations')">
    <span class="mob-nav-icon">‚ú¶</span><span class="mob-nav-label">Archive</span>
  </button>
  <button class="mob-nav-item" data-tab="progress"   onclick="showView('progress')">
    <span class="mob-nav-icon">üìà</span><span class="mob-nav-label">Progress</span>
  </button>
</div>

<script src="shared.js"></script>
<script src="stage-app.js"></script>
<script>
// Stage-specific constant
const CURRENT_STAGE = 'married';

// If user has no stage or different stage, set this one
if (!S.stage) S.setStage(CURRENT_STAGE);

// Init
window.addEventListener('load', () => {
  // Nav user info
  const nameEl = document.getElementById('nav-name');
  const initEl = document.getElementById('nav-initial');
  if (nameEl) nameEl.textContent = S.userName || (S.email ? S.email.split('@')[0] : '');
  if (initEl) initEl.textContent = (S.userName || S.email || '?').charAt(0).toUpperCase();

  // Show library
  showView('library');
});

// Nav tab active state sync
function syncNavTabs(view) {
  document.querySelectorAll('#nav-lib-tabs .nav-tab').forEach(tab => {
    tab.classList.toggle('active', tab.dataset.tab === view);
  });
  const libTabs = document.getElementById('nav-lib-tabs');
  const backBtn = document.getElementById('nav-back');
  const isSession = ['session-deep','session-flash','confirm'].includes(view);
  if (libTabs) libTabs.style.display = isSession ? 'none' : 'flex';
  if (backBtn) backBtn.style.display = isSession ? 'flex' : 'none';
  // also sync mob nav tab active
  document.querySelectorAll('.mob-nav-item').forEach(el => {
    const tabMap = { library:'sessions', declarations:'archive', progress:'progress' };
    el.classList.toggle('active', el.dataset.tab === tabMap[view]);
  });
}

// Patch showView to also sync nav tabs
const _showView = showView;
function showView(name) {
  _showView(name);
  syncNavTabs(name);
}

function goBackFromSession() {
  showView('session-picker');
}
</script>
</body>
</html>